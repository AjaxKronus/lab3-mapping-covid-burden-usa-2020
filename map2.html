<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>US COVID-19 Cases Proportional Symbols, 2020</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id='title'>US COVID-19 Total Cases</div>
    <div id='subtitle'>Proportional Symbols | 2020</div>
    <div id='map'></div>
    <div id='legend'></div>

    <script src="js/main.js"></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYW1hcnR5YWNoYXViZSIsImEiOiJjbWhkeWRlczYwOGQxMnZwdjJyYWwydmhoIn0.gWwGNyVcD1xoO5v2UXrJ0Q';
        
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-98.5795, 39.8283],
            zoom: 3.5
        });

        map.on('load', () => {
            map.addSource('covid-counts', {
                'type': 'geojson',
                'data': 'assets/us-covid-2020-counts.geojson'
            });
            
            map.addLayer({
                'id': 'covid-counts-circles',
                'type': 'circle',
                'source': 'covid-counts',
                'paint': {
                    'circle-radius': [
                        'interpolate', ['linear'], ['sqrt'], ['get', 'total_cases'],
                        0, 0,
                        1000000, 25,
                        5000000, 50
                    ],
                    'circle-color': '#f03b20',
                    'circle-stroke-color': 'white',
                    'circle-stroke-width': 2,
                    'circle-opacity': 0.8
                }
            });

            map.on('click', 'covid-counts-circles', (e) => {
                new mapboxgl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML(`
                        <strong>${e.features[0].properties.NAME}</strong><br>
                        Total cases: ${e.features[0].properties.total_cases.toLocaleString()}<br>
                        Rate per 1k: ${e.features[0].properties.rate_per_100k?.toFixed(1) || 'N/A'}
                    `)
                    .addTo(map);
            });
            
            map.on('mouseenter', 'covid-counts-circles', () => { map.getCanvas().style.cursor = 'pointer'; });
            map.on('mouseleave', 'covid-counts-circles', () => { map.getCanvas().style.cursor = ''; });
            
            addProportionalLegend();
        });
    </script>
</body>
</html>
